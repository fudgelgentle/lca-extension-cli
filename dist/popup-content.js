(()=>{const e="https://lca-server-api.fly.dev",n=chrome.runtime.getURL("../assets/img/lca-48.png"),t=chrome.runtime.getURL("../assets/img/plus-square-icon.png"),o=chrome.runtime.getURL("../assets/img/fire-black-icon.png"),s=chrome.runtime.getURL("../assets/img/fire-grey-icon.png"),i=chrome.runtime.getURL("../assets/img/red-trash-icon.png"),c=chrome.runtime.getURL("../assets/img/most-green-icon.png"),a=chrome.runtime.getURL("../assets/img/equivalent-icon.png"),r=document.createElement("div");r.classList.add("master-lca"),r.classList.add("br-8"),r.classList.add("hidden"),document.body.append(r);const l=document.createElement("div");l.setAttribute("id","placeholder"),document.body.append(l);const d=l.attachShadow({mode:"open"});function g(e){return e<1?{weight:parseFloat((100*e).toFixed(2)),unit:"g"}:e>=1e3?{weight:parseFloat((e/1e3).toFixed(2)),unit:"tons"}:{weight:parseFloat(e.toFixed(2)),unit:"kg"}}function p(e,n){const t=new MutationObserver((e=>{e.forEach((e=>{"attributes"===e.type&&"class"===e.attributeName&&n(e.target)}))}));return t.observe(e,{attributes:!0}),t.disconnect}function u(){const e=document.getElementById("fromGoogleAddress"),n=document.getElementById("toGoogleAddress"),t=()=>{const t=e.classList.contains("ng-valid"),o=n.classList.contains("ng-valid");t&&o?(console.log("both input are valid"),h(),m(),v()):console.log("At least one input is invalid")};p(e,t),p(n,t),t()}function m(){const e=document.getElementById("package-details__package-type");e.addEventListener("change",(()=>{console.log("packaging type is changed to: "+e.value);const n=document.getElementById("package-details__weight-0"),t=document.getElementById("package-details__quantity-0");n.addEventListener("input",v),t.addEventListener("input",v)}))}function v(){document.getElementById("e2ePackageDetailsSubmitButtonRates").addEventListener("click",f)}function h(){document.querySelectorAll("input, select, textarea").forEach((e=>{"package-details__package-type"!=e.id&&"fromGoogleAddress"!=e.id&&"toGoogleAddress"!=e.id&&(e.addEventListener("change",v),e.addEventListener("input",v))}))}async function f(){document.getElementById("e2ePackageDetailsSubmitButtonRates").removeEventListener("click",f),console.log("fedexButton is clicked");const l=document.getElementById("fromGoogleAddress"),p=l?l.value:null,u=document.getElementById("toGoogleAddress"),m=u?u.value:null,v=document.getElementById("package-details__quantity-0"),h=v?parseInt(v.value):null,E=document.getElementById("package-details__weight-0");let B=E?parseInt(E.value):null;const C=document.querySelector('select[data-e2e-id="selectMeasurement"]'),S=C?C.value:null;if(console.log("packageWeight original: "+B),S.includes("IMPERIAL")&&(B*=.453),console.log("fromAddress: "+p),console.log("toAddress: "+m),console.log("packageCount: "+h),console.log("unit: "+S),console.log("packageWeight in kg: "+B),p&&m&&h&&B){const l=B*h,u=await async function(n,t,o){console.log("calling testClimatiqAPI...");const s={route:[{location:{query:n}},{transport_mode:"road"},{transport_mode:"sea"},{transport_mode:"road"},{location:{query:t}}],cargo:{weight:o,weight_unit:"kg"}};try{const n=await fetch(e+"/api/freight",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);const t=await n.json();return console.log("API Response: ",t),t}catch(e){console.error("Error:",e)}}(p,m,l),v={from:p,to:m,co2eValue:parseFloat(u.co2e.toFixed(2))};null!==d.querySelector(".freight-container")?(console.log("FREIGHT CONTAINER EXISTS, updating freight"),await async function(e){const n=d.querySelector(".floating-lca-menu");n.classList.contains("visible-b")?(console.log("floating menu contains visible-b: "),x(n,"b"),k(r,"b")):console.log("floating menu doesnt contain visible-b: "),console.log(n);let t=d.querySelector(".loading-box-2");t.classList.remove("hidden-a"),t.classList.add("visible-a");let o=d.querySelector(".freight-content");o.classList.add("hidden"),console.log("UPDATING FREIGHT CONTENT");const s=e.from,i=e.to,c=e.co2eValue;let a=c/1.15;const l=g(a);a=l.weight;const p=l.unit,u=d.querySelector(".fz-20.freight-co2e-value b"),m=d.querySelector(".trash-value"),v=d.getElementById("f-from"),h=d.getElementById("t-to");u.textContent=c+" kg CO2e",m.textContent="or "+a+" "+p+" of trash burned",v.textContent=" "+s,h.textContent=" "+i,await L(),o.classList.remove("hidden")}(v)):(console.log("FREIGHT CONTAINER DOESNT EXIST, injecting freight"),function(e,l){const p=`\n    <section class="lca-banner flex-stretch">\n      <div class="flex-center title-container br-8 pd-12">\n        <img src="${n}" alt="LCA Image" class="icon-20">\n        <p class="title-text fz-20 eco-bold"><b>LCA-Viz</b></p>\n      </div>\n      <div class="flex-center close-container br-8 pd-16">\n        <svg class="icon-20" width="100%" height="100%" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n      </div>\n    </section>\n  `;r.insertAdjacentHTML("beforeend",p);const u=`\n    <div class="flex-center floating-lca-menu pd-12 br-8 hidden-b">\n      <img src="${n}" alt="LCA Image" class="floating-lca-img icon-24">\n    </div>\n  `;if(r.insertAdjacentHTML("beforebegin",u),function(){const e=d.querySelector(".close-container"),n=d.querySelector(".floating-lca-menu");e.addEventListener("click",(()=>{x(r,"b"),k(n,"b")})),n.addEventListener("click",(()=>{x(n,"b"),k(r,"b")}))}(),"phone"===e){const e=`\n    <div class="phone-master-container">\n      <section class="phone-container br-8 pd-16 hidden-a">\n        <div class="loading-box flex-center br-8 pd-16">\n          <div class="loader">\n            <div class="circle"></div>\n            <div class="circle"></div>\n            <div class="circle"></div>\n          </div>\n        </div>\n        <section class="phone-spec-container fz-20 hidden-a"></section>\n      </section>\n\n\n      <section class="compare-phone br-8 hidden-a">\n        <div class="compare-container br-8 pd-4">\n          <div class="flex-center compare-btn">\n            <img src="${t}" class="icon-20">\n            <p class="fz-16 margin-8">Compare</p>\n          </div>\n        </div>\n        <div class="select-phone-container br-8 pd-16 slide-content">\n          <div class="flex-center close-phone-btn">\n            <svg class="icon-20" width="100%" height="100%" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n              <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n            </svg>\n          </div>\n          <p class="margin-0 fz-20">Select phone model</p>\n          <p class="phone-spec-title fz-12">Comparing with: <b>iPhone 15 Pro</b></p>\n          <div class="search-container br-8 pd-16 fz-16">\n            <input type="text" id="search-phone" class="grey-text fz-16" placeholder="Search..." title="Type to search for phone models">\n            <div class="phone-model-container">\n            </div>\n          </div>\n        </div>\n      </section>\n\n      <section class="side-by-side-section hidden-a">\n        <div class="side-by-side-container flex-center">\n          <div class="side-by-side-spec-container grid-1fr-1fr cg-12"></div>\n        </div>\n      </section>\n    </div>\n  `;r.insertAdjacentHTML("beforeend",e),(m=d.getElementById("search-phone")).addEventListener("keydown",(e=>{e.stopPropagation()})),m.addEventListener("keyup",(e=>{e.stopPropagation()})),m.addEventListener("keypress",(e=>{e.stopPropagation()})),setTimeout((()=>{r.classList.remove("hidden"),async function(){d.querySelector(".phone-container").classList.remove("hidden-a"),await async function(){console.log("got inside hideLoadingIcon");let e=d.querySelector(".loading-box");return e?new Promise((n=>{setTimeout((()=>{console.log("Adding hidden-a class to loadingBox"),e.classList.add("hidden-a"),console.log("hidden-a class added:",e.classList),console.log("loading-box: ",e),n()}),1500)})):(console.error("loadingBox not found"),Promise.resolve())}();const e=d.querySelector(".phone-spec-container"),n=d.querySelector(".compare-phone");k(e,"a"),n.classList.remove("hidden-a"),function(){const e="iPhone 15 Pro",n=[{storage:"128 GB",co2e:"12 kg CO2e"},{storage:"256 GB",co2e:"24 kg CO2e"},{storage:"512 GB",co2e:"48 kg CO2e"},{storage:"1 TB",co2e:"96 kg CO2e"}],t=d.querySelector(".phone-spec-container"),o=n,i=e;t.innerHTML+=`\n    <p class="phone-spec-title eco-bold" id="currentPhone"><b>${i} Carbon Emissions</b></p>\n  `;let r=o[0];o.forEach((e=>{parseFloat(e.co2e.split(" ")[0])<parseFloat(r.co2e.split(" ")[0])&&(r=e)})),o.forEach(((e,n)=>{const o=parseFloat(e.co2e.split(" ")[0]),i=parseFloat(r.co2e.split(" ")[0]),l=(o-i)/i*100,d=e.storage===r.storage;t.innerHTML+=`\n      <div class="details-container fz-16" id=${n+"-c"}>\n        <div class="flex-center ${d?"most-green":""} cg-4">\n          <p class="eco-bold"><b>${e.storage} </b>&nbsp;</p>\n          ${d?`<img src="${c}" class="icon-16" alt="Most eco-friendly option">`:`<span class="red-text fz-12">(+${l.toFixed(0)}% emissions)</span>`}\n        </div>\n        <div class="flex-center co2e-data-container pd-8 br-8 cg-4 lexend-reg">\n          <p class="margin-0">${e.co2e}</p>\n          <img src="${a}" class="icon-16" alt="Equivalent to">\n          <div class="flex-center cg-4">\n            <p class="margin-0 grey-text fz-16">${(o/1.15).toFixed(2)} kg of trash burned</p>\n            <img src="${s}" class="icon-16" alt="Trash">\n          </div>\n        </div>\n      </div>\n      `}))}(),function(){const e=d.querySelector(".compare-btn"),n=d.querySelector(".compare-phone"),t=d.querySelector(".compare-container"),o=d.querySelector(".slide-content");e.addEventListener("click",(async()=>{await async function(){const e=[{id:1,device:"Samsung Galaxy S24 Ultra",carbonFootprint:[{storage:"256 GB",co2e:"26 kg CO2e"},{storage:"512 GB",co2e:"50 kg CO2e"},{storage:"1 TB",co2e:"98 kg CO2e"}]},{id:2,device:"Samsung Galaxy Z Flip 5",carbonFootprint:[{storage:"256 GB",co2e:"22 kg CO2e"},{storage:"512 GB",co2e:"44 kg CO2e"}]},{id:3,device:"OnePlus 12R",carbonFootprint:[{storage:"128 GB",co2e:"18 kg CO2e"},{storage:"256 GB",co2e:"36 kg CO2e"}]},{id:4,device:"Google Pixel 8 Pro",carbonFootprint:[{storage:"128 GB",co2e:"20 kg CO2e"},{storage:"256 GB",co2e:"40 kg CO2e"},{storage:"512 GB",co2e:"80 kg CO2e"}]}],n=d.querySelector(".phone-model-container");n.innerHTML="",e.forEach(((t,o)=>{const s=document.createElement("p");s.className="phone-model-text br-4"+(o===e.length-1?" last":""),s.id=t.id,s.textContent=t.device,n.appendChild(s)}))}(),n.classList.add("down"),t.classList.add("hide"),o.classList.add("slide-down"),function(){const e=d.querySelector(".phone-model-container").children;Array.from(e).forEach((e=>{e.addEventListener("click",(e=>{const n=parseInt(e.target.id),t=d.querySelector(".compare-phone"),o=d.querySelector(".compare-container"),s=d.querySelector(".slide-content");t.classList.remove("down"),o.classList.remove("hide"),s.classList.remove("slide-down"),function(e){const n="iPhone 15 Pro",t=[{storage:"128 GB",co2e:"12 kg CO2e"},{storage:"256 GB",co2e:"24 kg CO2e"},{storage:"512 GB",co2e:"48 kg CO2e"},{storage:"1 TB",co2e:"96 kg CO2e"}],o=[{id:1,device:"Samsung Galaxy S24 Ultra",carbonFootprint:[{storage:"256 GB",co2e:"26 kg CO2e"},{storage:"512 GB",co2e:"50 kg CO2e"},{storage:"1 TB",co2e:"98 kg CO2e"}]},{id:2,device:"Samsung Galaxy Z Flip 5",carbonFootprint:[{storage:"256 GB",co2e:"22 kg CO2e"},{storage:"512 GB",co2e:"44 kg CO2e"}]},{id:3,device:"OnePlus 12R",carbonFootprint:[{storage:"128 GB",co2e:"18 kg CO2e"},{storage:"256 GB",co2e:"36 kg CO2e"}]},{id:4,device:"Google Pixel 8 Pro",carbonFootprint:[{storage:"128 GB",co2e:"20 kg CO2e"},{storage:"256 GB",co2e:"40 kg CO2e"},{storage:"512 GB",co2e:"80 kg CO2e"}]}].find((n=>n.id===e)),s=d.querySelector(".side-by-side-section"),a=d.querySelector(".phone-container");let r=d.querySelector(".side-by-side-spec-container");r.innerHTML="",r.innerHTML+=`\n    <p class="margin-0 side-phone-text fz-16"><b>${n}</b></p>\n    <p class="margin-0 side-phone-text fz-16"><b>${o.device}</b></p>\n    <img src="${i}" class="icon-16 trash-btn" alt="remove device">\n  `;let l=function(e,n){const t=new Set([...e.map((e=>e.storage)),...n.map((e=>e.storage))]),o=Array.from(t).sort(((e,n)=>y(e)-y(n))),s=[],i=[];o.forEach((t=>{const o=e.find((e=>e.storage===t)),c=n.find((e=>e.storage===t));s.push(o||{storage:t,co2e:"--"}),i.push(c||{storage:t,co2e:"--"})}));for(let e=0;e<s.length;e++)"--"==s[e].co2e&&(s[e].storage="--"),"--"==i[e].co2e&&(i[e].storage="--");return[s,i]}(t,o.carbonFootprint),g=l[0],p=l[1];for(let e=0;e<g.length;e++)r.innerHTML+=`\n      <div class="details-container fz-16">\n        <div class="flex-center most-green cg-4">\n          <p><b>${g[e].storage}</b>&nbsp;</p>\n          ${0===e?`<img src="${c}" class="icon-16" alt="Most eco-friendly option">`:""}\n        </div>\n        <div class="flex-center co2e-data-container pd-8 br-8 cg-4 lexend-reg">\n          <p class="margin-0">${g[e].co2e}</p>\n        </div>\n      </div>\n      <div class="details-container fz-16">\n        <div class="flex-center most-green cg-4">\n          <p><b>${p[e].storage}</b>&nbsp;</p>\n          ${0===e?`<img src="${c}" class="icon-16" alt="Most eco-friendly option">`:""}\n        </div>\n        <div class="flex-center co2e-data-container pd-8 br-8 cg-4 lexend-reg">\n          <p class="margin-0">${p[e].co2e}</p>\n        </div>\n      </div>\n    `;r.querySelector(".trash-btn").addEventListener("click",(()=>{x(s,"a"),k(a,"a")})),d.querySelector(".lca-banner").insertAdjacentElement("afterend",s),a.classList.contains("hidden-a")?(x(s,"a"),k(s,"a")):(x(a,"a"),k(s,"a"))}(n)}))}))}()})),d.querySelector(".close-phone-btn").addEventListener("click",(()=>{n.classList.remove("down"),t.classList.remove("hide"),o.classList.remove("slide-down")}))}(),d.getElementById("search-phone").addEventListener("keyup",b)}()}),0)}else if("freight"===e){const e=function(e){const n=e.from,t=e.to,s=e.co2eValue;let i=s/1.15;const c=g(i);return i=c.weight,`\n    <div class="freight-container br-8 pd-16 hidden-a">\n      <div class="loading-box-2 flex-center br-8 pd-16">\n        <div class="loader">\n          <div class="circle"></div>\n          <div class="circle"></div>\n          <div class="circle"></div>\n        </div>\n      </div>\n      <div class="freight-content hidden-a">\n        <p class="fz-16 freight-title-text"><b>Your package&apos;s estimated carbon emissions:</b></p>\n        <div class="freight-emissions flex-column-center br-8 rg-12 pd-16">\n          <span class="fz-20 freight-co2e-value"><b>${s} kg CO2e</b></span>\n          <div class="flex-center cg-4">\n            <span class="trash-value">or ${i} ${c.unit} of trash burned</span>\n            <img src="${o}" class="icon-16" alt="Trash">\n          </div>\n        </div>\n        <div class="shipping-container">\n          <p class="fz-12"><b>Shipping Details</b></p>\n          <div class="shipping-info fz-12">\n            <p class="from-to-text"><b>From:</b> <span id="f-from">${n}</span></p>\n            <p class="from-to-text"><b>To:</b> <span id="t-to">${t}</span></p>\n          </div>\n        </div>\n      </div>\n    </div>\n  `}(l);r.insertAdjacentHTML("beforeend",e),setTimeout((()=>{r.classList.remove("hidden"),async function(){d.querySelector(".freight-container").classList.remove("hidden-a"),await L(),k(d.querySelector(".freight-content"),"a")}()}),0)}var m}("freight",v))}else console.error("Invalid input.. Information is not complete")}function b(){let e=d.getElementById("search-phone").value.toUpperCase();const n=d.querySelector(".phone-model-container").children;for(let t=0;t<n.length;t++)(n[t].textContent||n[t].innerText).toUpperCase().indexOf(e)>-1?n[t].style.display="":n[t].style.display="none"}function y(e){const n=parseFloat(e);return e.includes("TB")?1024*n:e.includes("GB")?n:e.includes("MB")?n/1024:n}function L(){console.log("got inside hideLoadingIcon");let e=d.querySelector(".loading-box-2");return e?new Promise((n=>{setTimeout((()=>{console.log("Adding hidden-a class to loadingBox"),e.classList.add("hidden-a"),console.log("hidden-a class added:",e.classList),console.log("loading-box: ",e),n()}),1500)})):(console.error("loadingBox not found"),Promise.resolve())}function k(e,n){"a"===n?(e.classList.contains("flex-center")?e.style.display="flex":e.style.display="block",requestAnimationFrame((()=>{e.classList.remove("hidden-a"),e.classList.add("visible-a")}))):"b"===n&&(e.classList.contains("flex-center")?e.style.display="flex":e.style.display="block",requestAnimationFrame((()=>{e.classList.remove("hidden-b"),e.classList.add("visible-b")})))}function x(e,n){"a"===n?(e.classList.remove("visible-a"),e.classList.add("hidden-a"),e.addEventListener("transitionend",(function n(){e.classList.contains("hidden-a")&&(e.style.display="none"),e.removeEventListener("transitionend",n)}))):"b"===n&&(e.classList.remove("visible-b"),e.classList.add("hidden-b"),e.addEventListener("transitionend",(function n(){e.classList.contains("hidden-b")&&(e.style.display="none"),e.removeEventListener("transitionend",n)})))}d.appendChild(r),async function(){await async function(e){const n=await fetch(e),t=await n.text(),o=document.createElement("style");o.textContent=t,d.appendChild(o)}(chrome.runtime.getURL("../assets/popup-content.css")),window.location.hostname.includes("fedex.com")&&new MutationObserver(((e,n)=>{for(const t of e)if("childList"===t.type){const e=document.getElementById("e2ePackageDetailsSubmitButtonRates");if(console.log(e),e){e.addEventListener("click",f),n.disconnect(),h(),m(),u();break}}})).observe(document.body,{childList:!0,subtree:!0})}()})();